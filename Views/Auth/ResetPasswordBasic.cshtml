@Html.AntiForgeryToken()

@{
  Layout = "_BlankLayout";
  ViewData["Title"] = "Reset Password Basic - Pages";
}

@section VendorStyles {
  <link rel="stylesheet" href="~/vendor/libs/&#64;form-validation/form-validation.css" />
}

@section VendorScripts {
  <script src="~/vendor/libs/&#64;form-validation/popular.js"></script>
  <script src="~/vendor/libs/&#64;form-validation/bootstrap5.js"></script>
  <script src="~/vendor/libs/&#64;form-validation/auto-focus.js"></script>
}

@section PageStyles {
  <link rel="stylesheet" href="~/vendor/css/pages/page-auth.css">
}

@section PageScripts {
  <!-- Load Firebase libraries first -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>

  <!-- Then load your custom scripts -->
  <script src="~/js/firebase-init.js"></script>
  <script src="~/js/pages-auth.js"></script>
}

@* ************** Content ************** *@

<div class="container-xxl">
  <div class="authentication-wrapper authentication-basic container-p-y">
    <div class="authentication-inner py-6">
      <!-- Reset Password -->
      <div class="card">
        <div class="card-body">
          <!-- Logo -->
          <div class="app-brand justify-content-center mb-6">
            <a href="/" class="app-brand-link">
              <span class="app-brand-logo demo">@await Html.PartialAsync("../_Partials/_Macros")</span>
              <span class="app-brand-text demo text-heading fw-bold">@TempData.Peek("appName")</span>
            </a>
          </div>
          <!-- /Logo -->
          <h4 class="mb-1">Reset Password ðŸ”’</h4>

          <!-- Progress indicator -->
          <div class="reset-password-progress mb-4">
            <div class="d-flex justify-content-between">
              <div class="progress-item active" data-step="1">
                <div class="progress-circle">1</div>
                <div class="progress-text">Phone</div>
              </div>
              <div class="progress-line"></div>
              <div class="progress-item" data-step="2">
                <div class="progress-circle">2</div>
                <div class="progress-text">Verify</div>
              </div>
              <div class="progress-line"></div>
              <div class="progress-item" data-step="3">
                <div class="progress-circle">3</div>
                <div class="progress-text">Password</div>
              </div>
            </div>
          </div>

          <!-- Step 1: Phone Number Form -->
          <div id="step1" class="reset-step">
            <p class="mb-6">Enter your phone number to reset your password</p>

            <form id="phoneForm">
              <div class="mb-6">
                <label class="form-label" for="phone">Phone Number</label>
                <div class="input-group">
                  <span class="input-group-text">+961</span>
                  <input type="text" id="phone" class="form-control" name="phone" placeholder="71 123 456" required />
                </div>
                <div class="form-text">Enter your Lebanese phone number</div>
              </div>
              <!-- reCAPTCHA container ONLY in Step 1 -->
              <div id="recaptcha-container" class="my-4"></div>
              <button id="phoneSubmitBtn" type="submit" class="btn btn-primary d-grid w-100 mb-6" disabled>
                Submit
              </button>
              <div class="text-center">
                <a href="/Auth/LoginBasic">
                  <i class="ti ti-chevron-left scaleX-n1-rtl me-1_5"></i>
                  Back to login
                </a>
              </div>
            </form>
          </div>

          <!-- Step 2: OTP Verification Form -->
          <div id="step2" class="reset-step" style="display: none;">
            <p class="mb-6">Enter the verification code sent to your phone</p>
            <form id="otpForm">
              <div class="mb-6">
                <label class="form-label" for="otp">Verification Code</label>
                <input type="text" id="otp" class="form-control" name="otp" placeholder="123456" required />
                <div class="form-text">Enter the 6-digit verification code</div>
              </div>
              <button id="otpSubmitBtn" type="button" class="btn btn-primary d-grid w-100 mb-6">
                Verify
              </button>
              <div class="text-center">
                <a href="javascript:void(0)" onclick="goToStep(1)">
                  <i class="ti ti-chevron-left scaleX-n1-rtl me-1_5"></i>
                  Back to phone entry
                </a>
              </div>
            </form>
          </div>

          <!-- Step 3: New Password Form -->
          <div id="step3" class="reset-step" style="display: none;">
            <p class="mb-6"><span class="fw-medium">Your new password must be different from previously used
                passwords</span></p>
            <form id="passwordForm">
              <div class="mb-6 form-password-toggle">
                <label class="form-label" for="password">New Password</label>
                <div class="input-group input-group-merge">
                  <input type="password" id="password" class="form-control" name="password"
                    placeholder="&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;"
                    aria-describedby="password" required minlength="6" />
                  <span class="input-group-text cursor-pointer"><i class="ti ti-eye-off"></i></span>
                </div>
              </div>
              <div class="mb-6 form-password-toggle">
                <label class="form-label" for="confirm-password">Confirm Password</label>
                <div class="input-group input-group-merge">
                  <input type="password" id="confirm-password" class="form-control" name="confirm-password"
                    placeholder="&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;"
                    aria-describedby="password" required minlength="6" />
                  <span class="input-group-text cursor-pointer"><i class="ti ti-eye-off"></i></span>
                </div>
              </div>
              <button id="passwordSubmitBtn" type="button" class="btn btn-primary d-grid w-100 mb-6">
                Set new password
              </button>
              <div class="text-center">
                <a href="javascript:void(0)" onclick="goToStep(2)">
                  <i class="ti ti-chevron-left scaleX-n1-rtl me-1_5"></i>
                  Back to verification
                </a>
              </div>
            </form>
          </div>
        </div>
      </div>
      <!-- /Reset Password -->
    </div>
  </div>
</div>

<style>
  .reset-password-progress {
    margin: 30px 0;
  }

  .progress-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    flex: 1;
    position: relative;
  }

  .progress-circle {
    width: 30px;
    height: 30px;
    border-radius: 50%;
    background-color: #e0e0e0;
    color: #757575;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    margin-bottom: 8px;
  }

  .progress-line {
    height: 2px;
    background-color: #e0e0e0;
    width: 100%;
    margin-top: 15px;
    flex: 1;
  }

  .progress-item.active .progress-circle,
  .progress-item.completed .progress-circle {
    background-color: var(--bs-primary);
    color: white;
  }
</style>

<script>
  // Test script to verify JavaScript is working
  document.addEventListener('DOMContentLoaded', function () {
    console.log("DOM loaded in ResetPasswordBasic view");

    // Add a direct event handler to the button
    var phoneBtn = document.getElementById('phoneSubmitBtn');
    if (phoneBtn) {
      console.log("Found phone submit button directly in the view");
      phoneBtn.addEventListener('click', function () {
        console.log("Phone button clicked via direct handler");
      });
    }
  });
</script>
